function t__pagepreview__init() {
    var e = new URLSearchParams(window.location.search)
      , t = e.get("pageid")
      , r = !(!e.get("type") || "email" !== e.get("type"))
      , i = window.location.hash.split("_")[1]
      , n = -1 !== window.location.href.indexOf("preview")
      , o = window === window.parent
      , a = {
        res_320: "480px",
        res_480: "320px",
        res_640: "960px",
        res_1024: "768px",
        res_max: "100%"
    };
    window.lang = e.get("lang") || "EN",
    n ? 0 === window.location.hash.length && o && (t__pagepreview__drawPanel(t),
    (e = document.getElementById("t-page-preview-back")) && e.remove(),
    o = document.querySelector('.pe-preview__res-btn[data-preview-res="max"]')) && o.classList.add("pe-preview__res-btn_open") : (t__pagepreview__addIframe(t, i, a["res_" + i], r),
    t__pagepreview__drawPanel(t),
    setTimeout(function e() {
        var t = document.getElementById("iframe");
        void 0 !== t.contentWindow.t__pagepreview__changeCoverFontSize ? t.contentWindow.t__pagepreview__changeCoverFontSize(i) : setTimeout(e, 200)
    }),
    (e = document.querySelector('.pe-preview__res-btn[data-preview-res="' + i + '"]')) && e.classList.add("pe-preview__res-btn_open")),
    document.body.removeEventListener("mouseover", t__pagepreview__openPanel),
    document.body.addEventListener("mouseover", t__pagepreview__openPanel),
    document.querySelectorAll(".pe-preview__res-wrapper-btn .pe-preview__res-btn").forEach(function(e) {
        e.addEventListener("click", function() {
            t__pagepreview__switchBetweenRes(this, i, n, t, a, r)
        }),
        e.addEventListener("mouseenter", function() {
            var e = this.parentNode.getBoundingClientRect().y
              , t = this.getBoundingClientRect().x;
            document.body.insertAdjacentHTML("afterend", t__pagepreview__addTooltip(this, this.getAttribute("data-preview-res-interval"), e, t))
        }),
        e.addEventListener("mouseleave", function() {
            var e = document.querySelector(".pe-preview__tooltip");
            e && e.remove()
        })
    }),
    window.isPagePreview = !0
}
function t__pagepreview__addIframe(t, e, r, i) {
    document.body.innerHTML = '<div class="pe-preview__container"></div>';
    var n = document.querySelector(".pe-preview__container");
    n && (n.innerHTML = '<iframe id="iframe" data-preview-iframe-res="res_' + e + '" data-preview-iframe-height="' + r + '" src="/page/preview/?pageid=' + t + '&previewmode=yes"></iframe>'),
    iframeURLChange(document.getElementById("iframe"), function(e) {
        console.log("URL changed:", e),
        e !== "/page/preview/?pageid=" + t + "&previewmode=yes" && "about:blank" !== e && (window.location.href = e)
    }),
    t__pagepreview__hideScrollOnMobile(e),
    t__pagepreview__setIframeHeight(e),
    i && t__pagepreview__zoomPage(e)
}
function t__pagepreview__setIframeHeight(e) {
    var t, r = parent.document.body.clientHeight, e = document.querySelector('#iframe[data-preview-iframe-res="res_' + e + '"]');
    null !== e && (t = parseInt(e.getAttribute("data-preview-iframe-height")),
    e.style.height = r < t + 45 ? r - 45 : t)
}
function t__pagepreview__hideScrollOnMobile(e) {
    var t = document.querySelector('#iframe[data-preview-iframe-res="res_' + e + '"]');
    "max" !== e && setTimeout(function e() {
        t && null !== t.contentDocument.querySelector("#allrecords") ? t.contentDocument.head.innerHTML = t.contentDocument.head.innerHTML + "<style>html{overflow: scroll;}::-webkit-scrollbar{width:0px;background:transparent;}</style>" : setTimeout(e, 100)
    })
}
function t__pagepreview__zoomPage(i) {
    var n = document.querySelector('#iframe[data-preview-iframe-res="res_' + i + '"]');
    setTimeout(function e() {
        var t, r;
        if (null !== n.contentDocument.querySelector("#allrecords"))
            return t = n.contentDocument.querySelector("html"),
            "320" !== i ? void t.classList.remove("pe-preview__iframe-zoom") : (r = n.contentDocument.querySelector("#allrecords > table").offsetWidth,
            void (i < r && t.classList.add("pe-preview__iframe-zoom")));
        setTimeout(e, 100)
    })
}
function t__pagepreview__switchBetweenRes(e, r, t, i, n, o) {
    r = e.getAttribute("data-preview-res"),
    t && (t = document.getElementById("allrecords").getAttribute("data-tilda-project-id"),
    history.replaceState({}, "", "/page/responsive/?pageid=" + i + "&projectid=" + t + "&lang=" + window.lang + (o ? "&type=email" : "") + "#res_" + r),
    location.reload()),
    document.querySelectorAll(".pe-preview__res-btn").forEach(function(e) {
        e.classList.remove("pe-preview__res-btn_active")
    }),
    e.classList.add("pe-preview__res-btn_active"),
    t__pagepreview__switchBetweenMobileAndDesktop(r, n["res_" + r]),
    t__pagepreview__setIframeHeight(r),
    t__pagepreview__hideScrollOnMobile(r),
    o && t__pagepreview__zoomPage(r),
    setTimeout(function() {
        var t = document.getElementById("iframe");
        t && (t.contentWindow.t__pagepreview__changeCoverFontSize(r),
        t.contentWindow.document.querySelectorAll(".t-cover").forEach(function(e) {
            e = e.closest(".r").getAttribute("id").substr("3");
            t.contentWindow.t__pagepreview__fixCoverContentHeight(e)
        }))
    }, 800)
}
function t__pagepreview__openPanel(e) {
    var t, e = e.target.closest(".pe-preview__res-btn_open");
    e && ((t = document.querySelector(".pe-preview__res-wrapper-btn")) && t.classList.add("pe-preview__res-wrapper-btn_active"),
    (t = document.querySelector(".pe-preview__res-btn_open")) && t.classList.remove("pe-preview__res-btn_open"),
    document.querySelectorAll(".pe-preview__res-btn").forEach(function(e) {
        e.style.display = "inline"
    }),
    e.classList.add("pe-preview__res-btn_active"),
    (t = document.querySelector(".pe-preview__res-wrapper-btn_active")).removeEventListener("mouseleave", t__pagepreview__closePanel),
    t.addEventListener("mouseleave", t__pagepreview__closePanel))
}
function t__pagepreview__closePanel() {
    document.querySelectorAll(".pe-preview__res-btn:not(.pe-preview__res-btn_active):not(.pe-preview__res-btn_open)").forEach(function(e) {
        e.style.display = "none"
    });
    var e = document.querySelector(".pe-preview__res-wrapper-btn")
      , e = (e && e.classList.remove("pe-preview__res-wrapper-btn_active"),
    document.querySelector(".pe-preview__res-btn_active"));
    e && (e.classList.add("pe-preview__res-btn_open"),
    e.classList.remove("pe-preview__res-btn_active"))
}
function t__pagepreview__drawPanel(e) {
    var t = {
        RU: "Вернуться к редактированию",
        EN: "Back to editing",
        DE: "Zurück zum Bearbeiten"
    }
      , r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = (r = "") + '<div class="pe-preview__wrapper">' + ('<a href="/page/?pageid=' + e + '" class="pe-preview__btn">')) + (t[window.lang] || t.EN)) + "</a>" + '<div class="pe-preview__res-wrapper-btn">') + '<span class="pe-preview__res-btn" data-preview-res="320" data-preview-res-interval="320">' + '<svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">') + '<path fill-rule="evenodd" clip-rule="evenodd" d="M2.027 15.44a1.62 1.62 0 01-1.619-1.623V1.623C.408.727 1.14 0 2.027 0h5.701a1.62 1.62 0 011.62 1.623v12.194c0 .897-.732 1.623-1.62 1.623H2.027zm.006-3.25V2.288h5.689v9.902H2.033zm3.657 1.625a.813.813 0 10-1.625 0 .813.813 0 001.625 0z" fill="#fff"/>' + "</svg>") + "</span>" + '<span class="pe-preview__res-btn" data-preview-res="480" data-preview-res-interval="480">') + '<svg width="16" height="9" viewBox="0 0 16 9" fill="none" xmlns="http://www.w3.org/2000/svg">' + '<path fill-rule="evenodd" clip-rule="evenodd" d="M.527 1.619A1.62 1.62 0 012.151 0h12.193c.897 0 1.623.732 1.623 1.619V7.32a1.62 1.62 0 01-1.623 1.619H2.151A1.625 1.625 0 01.527 7.32V1.62zm3.25.006h9.903v5.689H3.778V1.625zM2.154 5.282a.813.813 0 100-1.625.813.813 0 000 1.625z" fill="#fff"/>') + "</svg>" + "</span>") + '<span class="pe-preview__res-btn" data-preview-res="640" data-preview-res-interval="640">' + '<svg width="16" height="22" viewBox="0 0 16 22" fill="none" xmlns="http://www.w3.org/2000/svg">') + '<path fill-rule="evenodd" clip-rule="evenodd" d="M1.573 21.956C.786 21.956.148 21.3.148 20.5V1.457C.148.653.793 0 1.573 0h12.15c.788 0 1.425.658 1.425 1.458v19.04c0 .805-.644 1.458-1.424 1.458H1.574zm.004-3.66V1.465H13.72v16.833H1.577zm7.143 1.83c0-.606-.48-1.097-1.072-1.097-.591 0-1.071.491-1.071 1.097 0 .607.48 1.098 1.071 1.098.592 0 1.072-.491 1.072-1.098z" fill="#fff"/>' + "</svg>") + "</span>" + '<span class="pe-preview__res-btn" data-preview-res="1024" data-preview-res-interval="1024">') + '<svg width="23" height="15" viewBox="0 0 23 15" fill="none" xmlns="http://www.w3.org/2000/svg">' + '<path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.425C0 .638.673 0 1.494 0h19.512c.825 0 1.494.645 1.494 1.425v12.15c0 .787-.673 1.425-1.494 1.425H1.494C.669 15 0 14.355 0 13.575V1.425zm3.75.004H21V13.57H3.75V1.43zM1.875 8.57C2.496 8.571 3 8.091 3 7.5c0-.592-.504-1.071-1.125-1.071S.75 6.909.75 7.5c0 .592.504 1.071 1.125 1.071z" fill="#fff"/>') + "</svg>" + "</span>") + '<span class="pe-preview__res-btn" data-preview-res="max" data-preview-res-interval="max">' + '<svg width="35" height="21" viewBox="0 0 35 21" fill="none" xmlns="http://www.w3.org/2000/svg">') + '<path d="M32.06 21H2.932c-1.496 0-2.71-.303-2.71-.677 0-.375 1.214-.678 2.71-.678H32.06c1.496 0 2.71.303 2.71.678 0 .374-1.214.677-2.71.677z" fill="#fff"/>' + '<path fill-rule="evenodd" clip-rule="evenodd" d="M2.932 1.36C2.932.609 3.54 0 4.288 0h26.415c.749 0 1.356.609 1.356 1.36v15.57c0 .75-.608 1.36-1.356 1.36H4.288a1.358 1.358 0 0 1-1.356-1.36V1.36zm1.354-.005h26.418v15.58H4.286V1.355z" fill="#fff"/>') + "</svg>" + "</span>") + "</div>" + "</div>";
    document.body.insertAdjacentHTML("beforeend", r)
}
function iframeURLChange(e, t) {
    function r() {
        t(e.contentWindow.location.href)
    }
    function i() {
        e.contentWindow.removeEventListener("unload", r),
        e.contentWindow.addEventListener("unload", r)
    }
    e.addEventListener("load", i),
    i()
}
function t__pagepreview__switchBetweenMobileAndDesktop(e, t) {
    "max" !== e ? (window.isMobile = !0,
    t__pagepreview__changeRes(e, t)) : (window.isMobile = !1,
    t__pagepreview__changeRes("max", t))
}
function t__pagepreview__changeRes(e, t) {
    var r = document.getElementById("iframe");
    null !== r && (r.setAttribute("data-preview-iframe-res", "res_" + e),
    r.setAttribute("data-preview-iframe-height", t)),
    history.replaceState({}, "", "#res_" + e)
}
function t__pagepreview__addTooltip(e, t, r, i) {
    return '<div class="pe-preview__tooltip' + ("max" === t ? " pe-preview__tooltip_max" : "") + '" style="top:' + (r - 45) + "px;left:" + (i + e.clientWidth / 2) + 'px;">' + ("max" !== t ? t + "px" : "max") + "</div>"
}
function t__pagepreview__fixCoverContentHeight(e) {
    var t, r, i = document.querySelector("#rec" + e), e = i.querySelector(".t-cover");
    e && (e = parseFloat(getComputedStyle(e, null).height.replace("px", "")),
    t = i.querySelector("div[data-hook-content]")) && (300 < (r = t.offsetHeight) && e < r + 40 ? (t__pagepreview__setCoverHeight(i, r),
    window.isMobile || setTimeout(function() {
        var e = i.querySelector(".t-cover__carrier");
        e.querySelector("iframe") && (console.log("correct video from cover_fixcontentheight"),
        t__pagepreview__setWidthHeightYoutubeVideo(e, r + "px")),
        e.querySelector("video") && console.log("correct html5video from cover_fixcontentheight")
    }, 2e3)) : t__pagepreview__setCoverHeight(i, r),
    t__pagepreview__updateCoverResizeElem(i))
}
function t__pagepreview__setCoverHeight(e, t) {
    var r, i, n, o = e.querySelector(".t-cover__carrier");
    o && (i = e.querySelector(".t-cover__carrier[data-content-cover-height]").getAttribute("data-content-cover-height"),
    r = window.frameElement.clientHeight,
    r = -1 !== i.indexOf("vh") ? Math.round(parseInt(i, 10) / 100 * r) : parseInt(i, 10),
    i = window.innerWidth <= 568 ? 40 : 120,
    n = window.innerWidth <= 568 ? 50 : 100,
    1e3 < (t += i) && (t += n),
    r = r < t ? t : r,
    console.log("auto correct cover height: " + r),
    i = e.querySelector(".t-cover"),
    n = e.querySelector(".t-cover__filter"),
    t = e.querySelector(".t-cover__wrapper"),
    i && (i.style.height = r + "px"),
    n && (n.style.height = r + "px"),
    o && (o.style.height = r + "px"),
    t) && (t.style.height = r + "px")
}
function t__pagepreview__updateCoverResizeElem(e) {
    if ("function" == typeof window.t_lazyload_updateResize_elem)
        try {
            window.t_lazyload_updateResize_elem(e.find(".t-cover__carrier"))
        } catch (e) {
            console.log("error:" + e)
        }
}
function t__pagepreview__changeCoverFontSize(e) {
    window.tpagepreviewfontsize = [];
    var t = document.querySelectorAll("div[data-customstyle=yes], [field] span, [field] strong, [field] em")
      , r = t.length;
    t.forEach(function(e) {
        void 0 !== window.tpagepreviewfontsize && window.tpagepreviewfontsize.length < r && window.tpagepreviewfontsize.push(parseFloat(getComputedStyle(e, null).fontSize.replace("px", "")))
    }),
    "320" === e ? t__pagepreview__setFontSize(26) : "480" === e || "640" === e ? t__pagepreview__setFontSize(30) : t.forEach(function(e, t) {
        e.style.fontSize = window.tpagepreviewfontsize[t] + "px"
    })
}
function t__pagepreview__setFontSize(i) {
    document.querySelectorAll("div[data-customstyle=yes], [field] span, [field] strong, [field] em").forEach(function(e, t) {
        var r;
        void 0 !== window.tpagepreviewfontsize && (r = parseFloat(getComputedStyle(e, null).fontSize.replace("px", "")),
        window.tpagepreviewfontsize[t] > i && i < r ? (e.style.fontSize = "",
        "DIV" == e.tagName && (e.style.lineHeight = "")) : window.tpagepreviewfontsize[t] <= i && (e.style.fontSize = window.tpagepreviewfontsize[t] + "px"))
    })
}
function t__pagepreview__setWidthHeightYoutubeVideo(e, t) {
    var r, i, n, o, a = e.querySelector("iframe"), p = e.getAttribute("data-content-video-nocover"), _ = e.getAttribute("data-content-video-noadcut-youtube"), s = e.getAttribute("data-content-video-ratio"), l = .5625;
    0 < s && (l = +parseFloat(s)),
    "yes" != p ? (p = -1 < (t = t || "100vh").indexOf("vh") ? (s = window.innerHeight,
    Math.floor(s * (parseInt(t) / 100))) : parseInt(t),
    i = r = (s = Math.floor(parseInt(window.innerWidth))) * l,
    o = r,
    n = 1,
    "yes" !== _ && (i = r + 110 + 110,
    o = r - 220),
    o < p && (n = r < p ? p / r + .02 : r / p + .02),
    _ = Math.floor(s * n),
    i = (o = Math.floor(i * n)) - p,
    n = _ - s,
    a.style.height = o + "px",
    a.style.width = _ + "px",
    0 < i && (a.style.marginTop = -Math.floor(i / 2) + "px"),
    0 < n && (a.style.marginLeft = -Math.floor(n / 2) + "px")) : (p = parseInt(e.style.paddingLeft) || 0,
    s = parseInt(e.style.paddingRight) || 0,
    o = e.clientWidth - (p + s),
    t || (r = Math.floor(o * l)),
    t && -1 < t.indexOf("vh") ? r = Math.floor(window.innerHeight * (parseInt(t) / 100)) : t && (r = parseInt(t)),
    a.style.width = "100%",
    a.height(r + "px"))
}
function t_ready(e) {
    "loading" != document.readyState ? e() : document.addEventListener ? document.addEventListener("DOMContentLoaded", e) : document.attachEvent("onreadystatechange", function() {
        "loading" != document.readyState && e()
    })
}
t_ready(function() {
    void 0 === window.isPagePreview && t__pagepreview__init()
});
